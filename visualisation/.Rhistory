suppressMessages({
  library(dplyr)
  library(ggplot2)
  library(RMySQL, lib='~/temp/Rlib')
  library(locuscomparer, lib='~/temp/Rlib')
})
tis <- "LIV"
#import full summary statistics
pq_filename <- paste("~/sean/INTRePID/STARNET/proteins/pQTLs/Olink2018-19_combined/STARNET_genotypedosageMAF05_Olink_cis-SNPs_500Kb_20180383_20181235_cases_combined_cis-pQTLs_P1.tsv", sep="")
pq <- read.table(pq_filename, sep="\t", header=TRUE)
eq_filename <- paste("~/sean/INTRePID/STARNET/gene_expression/eQTLs/", tis, "_STARNET_cases_matched_QTLs_cis-eQTLs_500Kb.tsv", sep="")
eq <- read.table(eq_filename, sep="\t", header=TRUE)
#import shared STARNET p/eQTLs and filter for tissue
qtl <- read.table("~/sean/INTRePID/STARNET/proteins/pQTLs/Olink2018-19_combined/STARNET_genotypedosageMAF05_Olink_cis-SNPs_500Kb_20180383_20181235_cases_combined_cis-pQTLs_FDR5_eQTL_overlap.tsv", sep="\t", header=TRUE)
qtl <- filter(qtl, tissue == tis)
head(pq)
#import colocalisation results and filter
coloc_filename <- paste("~/sean/INTRePID/STARNET/proteins/pQTLs/Olink2018-19_combined/coloc/", tis, "_STARNET_Olink_cis-SNPs_500Kb_cases_combined_cis-pQTLs_FDR5_eQTL_coloc.tsv", sep="")
coloc <- read.table(coloc_filename, sep="\t", header=TRUE)
coloc_filt <- filter(coloc, PP.H4.abf >= 0.9)
#function to run locuscomparer from list of genes
plot_locuscomparer <- function(gene) {
  
  qtl_filt <- filter(qtl, Gene_name==gene)
  eq_filt <- filter(eq, Gene_name==qtl_filt[1,10])
  pq_filt <- filter(pq, Protein_name==qtl_filt[1,3])
  
  mer <- merge(pq_filt, eq_filt, by='rs_number')
  
  eq_res <- select(mer, c("rs_number", "p.value.x"))
  pq_res <- select(mer, c("rs_number", "p.value.y"))
  colnames(eq_res) <- c("rsid", "pval")
  colnames(pq_res) <- c("rsid", "pval")
  
  lc_filename <- paste("~/sean/INTRePID/STARNET/proteins/pQTLs/Olink2018-19_combined/coloc/locuscomparer/", tis, "/", tis, "_STARNET_QTL_coloc_", gene, ".png", sep="")
  l <- locuscompare(in_fn1 = eq_res, in_fn2 = pq_res, title = paste(gene, 'eQTL', sep=' '), title2 = paste(gene, 'pQTL', sep=' '))
  ggsave(filename=lc_filename, plot=l, units="cm", width=15, height=12, dpi=300)
  print(lc_filename)
  
}
#Obtain locuscomparer plots for all listed genes
gene_list <- rownames(coloc_filt)
lapply(gene_list, plot_locuscomparer)
gene_list
#function to run locuscomparer from list of genes
plot_locuscomparer <- function(gene) {
  
  qtl_filt <- filter(qtl, Gene_name==gene)
  eq_filt <- filter(eq, Gene_name==qtl_filt[1,10])
  pq_filt <- filter(pq, Protein_name==qtl_filt[1,3])
  print(eq_filt)
  print(pq_filt)
  
  mer <- merge(pq_filt, eq_filt, by='rs_number')
  
  eq_res <- select(mer, c("rs_number", "p.value.x"))
  pq_res <- select(mer, c("rs_number", "p.value.y"))
  colnames(eq_res) <- c("rsid", "pval")
  colnames(pq_res) <- c("rsid", "pval")
  
  lc_filename <- paste("~/sean/INTRePID/STARNET/proteins/pQTLs/Olink2018-19_combined/coloc/locuscomparer/", tis, "/", tis, "_STARNET_QTL_coloc_", gene, ".png", sep="")
  l <- locuscompare(in_fn1 = eq_res, in_fn2 = pq_res, title = paste(gene, 'eQTL', sep=' '), title2 = paste(gene, 'pQTL', sep=' '))
  ggsave(filename=lc_filename, plot=l, units="cm", width=15, height=12, dpi=300)
  print(lc_filename)
  
}
#Obtain locuscomparer plots for all listed genes
gene_list <- rownames(coloc_filt)
lapply(gene_list, plot_locuscomparer)
head(qtl)
#import colocalisation results and filter
coloc_filename <- paste("~/sean/INTRePID/STARNET/proteins/pQTLs/Olink2018-19_combined/coloc/", tis, "_STARNET_Olink_cis-SNPs_500Kb_cases_combined_cis-pQTLs_FDR5_eQTL_coloc.tsv", sep="")
coloc <- read.table(coloc_filename, sep="\t", header=TRUE)
coloc_filt <- filter(coloc, PP.H4.abf >= 0.9)
#function to run locuscomparer from list of genes
plot_locuscomparer <- function(gene) {
  
  qtl_filt <- filter(qtl, Gene_name==gene)
  eq_filt <- filter(eq, Gene_name==qtl_filt[1,10])
  pq_filt <- filter(pq, Protein_name==qtl_filt[1,3])
  print(qtl_filt)
  
  mer <- merge(pq_filt, eq_filt, by='rs_number')
  
  eq_res <- select(mer, c("rs_number", "p.value.x"))
  pq_res <- select(mer, c("rs_number", "p.value.y"))
  colnames(eq_res) <- c("rsid", "pval")
  colnames(pq_res) <- c("rsid", "pval")
  
  lc_filename <- paste("~/sean/INTRePID/STARNET/proteins/pQTLs/Olink2018-19_combined/coloc/locuscomparer/", tis, "/", tis, "_STARNET_QTL_coloc_", gene, ".png", sep="")
  l <- locuscompare(in_fn1 = eq_res, in_fn2 = pq_res, title = paste(gene, 'eQTL', sep=' '), title2 = paste(gene, 'pQTL', sep=' '))
  ggsave(filename=lc_filename, plot=l, units="cm", width=15, height=12, dpi=300)
  print(lc_filename)
  
}
#Obtain locuscomparer plots for all listed genes
gene_list <- rownames(coloc_filt)
lapply(gene_list, plot_locuscomparer)
head(eq)
head(pq)
#function to run locuscomparer from list of genes
plot_locuscomparer <- function(gene) {
  
  qtl_filt <- filter(qtl, Gene_name==gene)
  eq_filt <- filter(eq, Gene_name==qtl_filt$Gene_name)
  pq_filt <- filter(pq, Gene_name==qtl_filt$Gene_name)
  print(qtl_filt)
  
  mer <- merge(pq_filt, eq_filt, by='rs_number')
  
  eq_res <- select(mer, c("rs_number", "p.value.x"))
  pq_res <- select(mer, c("rs_number", "p.value.y"))
  colnames(eq_res) <- c("rsid", "pval")
  colnames(pq_res) <- c("rsid", "pval")
  
  lc_filename <- paste("~/sean/INTRePID/STARNET/proteins/pQTLs/Olink2018-19_combined/coloc/locuscomparer/", tis, "/", tis, "_STARNET_QTL_coloc_", gene, ".png", sep="")
  l <- locuscompare(in_fn1 = eq_res, in_fn2 = pq_res, title = paste(gene, 'eQTL', sep=' '), title2 = paste(gene, 'pQTL', sep=' '))
  ggsave(filename=lc_filename, plot=l, units="cm", width=15, height=12, dpi=300)
  print(lc_filename)
  
}
#Obtain locuscomparer plots for all listed genes
gene_list <- rownames(coloc_filt)
lapply(gene_list, plot_locuscomparer)
#function to run locuscomparer from list of genes
plot_locuscomparer <- function(gene) {
  
  qtl_filt <- filter(qtl, Gene_name==gene)
  eq_filt <- filter(eq, Gene_name==qtl_filt$Gene_name)
  pq_filt <- filter(pq, Gene_name==qtl_filt$Gene_name)
  print(pq_filt)
  print(eq_filt)
  
  mer <- merge(pq_filt, eq_filt, by='rs_number')
  
  eq_res <- select(mer, c("rs_number", "p.value.x"))
  pq_res <- select(mer, c("rs_number", "p.value.y"))
  colnames(eq_res) <- c("rsid", "pval")
  colnames(pq_res) <- c("rsid", "pval")
  
  lc_filename <- paste("~/sean/INTRePID/STARNET/proteins/pQTLs/Olink2018-19_combined/coloc/locuscomparer/", tis, "/", tis, "_STARNET_QTL_coloc_", gene, ".png", sep="")
  l <- locuscompare(in_fn1 = eq_res, in_fn2 = pq_res, title = paste(gene, 'eQTL', sep=' '), title2 = paste(gene, 'pQTL', sep=' '))
  ggsave(filename=lc_filename, plot=l, units="cm", width=15, height=12, dpi=300)
  print(lc_filename)
  
}
#Obtain locuscomparer plots for all listed genes
gene_list <- rownames(coloc_filt)
lapply(gene_list, plot_locuscomparer)
#function to run locuscomparer from list of genes
plot_locuscomparer <- function(gene) {
  
  qtl_filt <- filter(qtl, Gene_name==gene)
  eq_filt <- filter(eq, Gene_name==qtl_filt$Gene_name)
  pq_filt <- filter(pq, Gene_name==qtl_filt$Gene_name)
  
  mer <- merge(pq_filt, eq_filt, by='rs_number')
  print(head(mer))
  
  eq_res <- select(mer, c("rs_number", "p.value.x"))
  pq_res <- select(mer, c("rs_number", "p.value.y"))
  colnames(eq_res) <- c("rsid", "pval")
  colnames(pq_res) <- c("rsid", "pval")
  
  lc_filename <- paste("~/sean/INTRePID/STARNET/proteins/pQTLs/Olink2018-19_combined/coloc/locuscomparer/", tis, "/", tis, "_STARNET_QTL_coloc_", gene, ".png", sep="")
  l <- locuscompare(in_fn1 = eq_res, in_fn2 = pq_res, title = paste(gene, 'eQTL', sep=' '), title2 = paste(gene, 'pQTL', sep=' '))
  ggsave(filename=lc_filename, plot=l, units="cm", width=15, height=12, dpi=300)
  print(lc_filename)
  
}
#Obtain locuscomparer plots for all listed genes
gene_list <- rownames(coloc_filt)
lapply(gene_list, plot_locuscomparer)
#function to run locuscomparer from list of genes
plot_locuscomparer <- function(gene) {
  
  qtl_filt <- filter(qtl, Gene_name==gene)
  eq_filt <- filter(eq, Gene_name==qtl_filt$Gene_name)
  pq_filt <- filter(pq, Gene_name==qtl_filt$Gene_name)
  
  mer <- merge(pq_filt, eq_filt, by='rs_number')
  print(head(mer))
  
  eq_res <- select(mer, c("rs_number", "p.value.x"))
  pq_res <- select(mer, c("rs_number", "p.value.y"))
  colnames(eq_res) <- c("rsid", "pval")
  colnames(pq_res) <- c("rsid", "pval")
  
  lc_filename <- paste("~/sean/INTRePID/STARNET/proteins/pQTLs/Olink2018-19_combined/coloc/locuscomparer/", tis, "/", tis, "_STARNET_QTL_coloc_", gene, ".png", sep="")
  l <- locuscompare(in_fn1 = eq_res, in_fn2 = pq_res, title = paste(gene, 'eQTL', sep=' '), title2 = paste(gene, 'pQTL', sep=' '))
  ggsave(filename=lc_filename, plot=l, units="cm", width=15, height=12, dpi=300)
  print(lc_filename)
  
}
#Obtain locuscomparer plots for all listed genes
gene_list <- rownames(coloc_filt)
lapply(gene_list, plot_locuscomparer)
#function to run locuscomparer from list of genes
plot_locuscomparer <- function(gene) {
  
  qtl_filt <- filter(qtl, Gene_name==gene)
  eq_filt <- filter(eq, Gene_name==qtl_filt$Gene_name)
  pq_filt <- filter(pq, Gene_name==qtl_filt$Gene_name)
  
  mer <- merge(pq_filt, eq_filt, by='rs_number')
  print(head(qtl_filt))
  
  eq_res <- select(mer, c("rs_number", "p.value.x"))
  pq_res <- select(mer, c("rs_number", "p.value.y"))
  colnames(eq_res) <- c("rsid", "pval")
  colnames(pq_res) <- c("rsid", "pval")
  
  lc_filename <- paste("~/sean/INTRePID/STARNET/proteins/pQTLs/Olink2018-19_combined/coloc/locuscomparer/", tis, "/", tis, "_STARNET_QTL_coloc_", gene, ".png", sep="")
  l <- locuscompare(in_fn1 = eq_res, in_fn2 = pq_res, title = paste(gene, 'eQTL', sep=' '), title2 = paste(gene, 'pQTL', sep=' '))
  ggsave(filename=lc_filename, plot=l, units="cm", width=15, height=12, dpi=300)
  print(lc_filename)
  
}
#Obtain locuscomparer plots for all listed genes
gene_list <- rownames(coloc_filt)
lapply(gene_list, plot_locuscomparer)
#function to run locuscomparer from list of genes
plot_locuscomparer <- function(gene) {
  
  qtl_filt <- filter(qtl, Gene_name==gene)
  eq_filt <- filter(eq, Gene_name==qtl_filt[1,6])
  pq_filt <- filter(pq, Gene_name==qtl_filt[1,6])
  
  mer <- merge(pq_filt, eq_filt, by='rs_number')
  print(head(qtl_filt))
  
  eq_res <- select(mer, c("rs_number", "p.value.x"))
  pq_res <- select(mer, c("rs_number", "p.value.y"))
  colnames(eq_res) <- c("rsid", "pval")
  colnames(pq_res) <- c("rsid", "pval")
  
  lc_filename <- paste("~/sean/INTRePID/STARNET/proteins/pQTLs/Olink2018-19_combined/coloc/locuscomparer/", tis, "/", tis, "_STARNET_QTL_coloc_", gene, ".png", sep="")
  l <- locuscompare(in_fn1 = eq_res, in_fn2 = pq_res, title = paste(gene, 'eQTL', sep=' '), title2 = paste(gene, 'pQTL', sep=' '))
  ggsave(filename=lc_filename, plot=l, units="cm", width=15, height=12, dpi=300)
  print(lc_filename)
  
}
#Obtain locuscomparer plots for all listed genes
gene_list <- rownames(coloc_filt)
lapply(gene_list, plot_locuscomparer)
#function to run locuscomparer from list of genes
plot_locuscomparer <- function(gene) {
  
  qtl_filt <- filter(qtl, Gene_name==gene)
  eq_filt <- filter(eq, Gene_name==qtl_filt[1,6])
  pq_filt <- filter(pq, Gene_name==qtl_filt[1,6])
  
  mer <- merge(pq_filt, eq_filt, by='rs_number')
  
  eq_res <- select(mer, c("rs_number", "p.value.x"))
  pq_res <- select(mer, c("rs_number", "p.value.y"))
  colnames(eq_res) <- c("rsid", "pval")
  colnames(pq_res) <- c("rsid", "pval")
  
  lc_filename <- paste("~/sean/INTRePID/STARNET/proteins/pQTLs/Olink2018-19_combined/coloc/locuscomparer/", tis, "/", tis, "_STARNET_QTL_coloc_", gene, ".png", sep="")
  l <- locuscompare(in_fn1 = eq_res, in_fn2 = pq_res, title = paste(gene, 'eQTL', sep=' '), title2 = paste(gene, 'pQTL', sep=' '))
  ggsave(filename=lc_filename, plot=l, units="cm", width=15, height=12, dpi=300)
  print(lc_filename)
  
}
#Obtain locuscomparer plots for all listed genes
gene_list <- rownames(coloc_filt)
lapply(gene_list, plot_locuscomparer)
gene_lsit
gene_list
plot_locuscomparer("GLB1")
plot_locuscomparer("LY75")
#function to run locuscomparer from list of genes
plot_locuscomparer <- function(gene) {
  
  qtl_filt <- filter(qtl, Gene_name==gene)
  eq_filt <- filter(eq, Gene_name==qtl_filt[1,6])
  pq_filt <- filter(pq, Gene_name==qtl_filt[1,6])
  
  mer <- merge(pq_filt, eq_filt, by='rs_number')
  
  eq_res <- select(mer, c("rs_number", "p.value.x"))
  pq_res <- select(mer, c("rs_number", "p.value.y"))
  colnames(eq_res) <- c("rsid", "pval")
  colnames(pq_res) <- c("rsid", "pval")
  print(head(eq_res))
  print(head(pq_res))
  
  lc_filename <- paste("~/sean/INTRePID/STARNET/proteins/pQTLs/Olink2018-19_combined/coloc/locuscomparer/", tis, "/", tis, "_STARNET_QTL_coloc_", gene, ".png", sep="")
  l <- locuscompare(in_fn1 = eq_res, in_fn2 = pq_res, title = paste(gene, 'eQTL', sep=' '), title2 = paste(gene, 'pQTL', sep=' '))
  ggsave(filename=lc_filename, plot=l, units="cm", width=15, height=12, dpi=300)
  print(lc_filename)
  
}
plot_locuscomparer("CD300C")
plot_locuscomparer("IL10RB")
quit()
